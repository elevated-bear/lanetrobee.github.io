<!DOCTYPE html>
<html>
<head>
	<title>Mario.js</title>
	<meta charset="UTF-8">
	<style>
	body  {background-color: gray;}
	canvas{background-color: green;}
	</style>
</head>
<body align=center>
<h2 >Lane Trobee Assignemnt 7 : javascript</h2>

<canvas id="myCanvas" width="500" height="500" style="border:1px solid #cccccc;"></canvas>

<script type="text/javascript">
/*
{"sprites":[
{"type":"Mario","x":100,"y":200,"w":60,"h":95,"vert_vel":20.399999999999995,"horz_vel":0.0,"coinCounter":0},
{"type":"Brick","x":44,"y":400,"w":381,"h":40,"vert_vel":0.0,"horz_vel":0.0,"coinCounter":0},
{"type":"CoinBlock","x":237,"y":102,"w":89,"h":83,"vert_vel":0.0,"horz_vel":0.0,"coinCounter":0},
{"type":"CoinBlock","x":480,"y":350,"w":89,"h":83,"vert_vel":0.0,"horz_vel":0.0,"coinCounter":0},
{"type":"CoinBlock","x":600,"y":350,"w":89,"h":83,"vert_vel":0.0,"horz_vel":0.0,"coinCounter":0},
{"type":"CoinBlock","x":700,"y":345,"w":89,"h":83,"vert_vel":0.0,"horz_vel":0.0,"coinCounter":0},
{"type":"CoinBlock","x":700,"y":102,"w":89,"h":83,"vert_vel":0.0,"horz_vel":0.0,"coinCounter":0}]}
*/


class Sprite
{
	constructor(x, y, image_url, update_method, onclick_method)
	{
		this.x = x;
		this.y = y;
		this.test = 250;
		this.image = new Image();
		this.image.src = image_url;
		this.update = update_method;
		this.onclick = onclick_method;
		
		//TODO: have a way to detect width and height
	}

	set_destination(x, y)
	{
		this.dest_x = x;
		this.dest_y = y;
	}

	ignore_click(x, y)
	{
	}

	move(dx, dy)
	{
		this.dest_x = this.x + dx;
		this.dest_y = this.y + dy;
	}

	go_toward_destination()
	{
		if(this.dest_x === undefined)
			return;

		if(this.x < this.dest_x)
			this.x++;
		else if(this.x > this.dest_x)
			this.x--;
		if(this.y < this.dest_y)
			this.y++;
		else if(this.y > this.dest_y)
			this.y--;
	}

	sit_still()
	{
	}
}

class Mario extends Sprite
{
	constructor(x, y, image_url, update_method, onclick_method)
	{
		super(x, y, image_url, update_method, onclick_method)
		//window.alert(test);
	}
	
	
}


class Model
{
	constructor()
	{
		this.sprites = [];
		this.sprites.push(new Sprite(200, 100, "lettuce.png", 
						             Sprite.prototype.sit_still, 
									 Sprite.prototype.ignore_click));
		this.turtle = new Mario(50, 50, "mario.png", 
						         Sprite.prototype.go_toward_destination, 
								 Sprite.prototype.set_destination);
		this.sprites.push(this.turtle);
	}

	update()
	{
		for(let i = 0; i < this.sprites.length; i++)
		{
			this.sprites[i].update();
		}
	}

	onclick(x, y)
	{
		for(let i = 0; i < this.sprites.length; i++)
		{
			this.sprites[i].onclick(x, y);
		}
	}

	move(dx, dy)
	{
		this.turtle.move(dx, dy);
	}
}




class View
{
	constructor(model)
	{
		this.model = model;
		this.canvas = document.getElementById("myCanvas");
		this.turtle = new Image();
		this.turtle.src = "mario.png";
	}

	update()
	{
		let ctx = this.canvas.getContext("2d");
		ctx.clearRect(0, 0, 1000, 500);
		for(let i = 0; i < this.model.sprites.length; i++)
		{
			let sprite = this.model.sprites[i];
			ctx.drawImage(sprite.image, sprite.x, sprite.y);
		}
	}
}







class Controller
{
	constructor(model, view)
	{
		this.model = model;
		this.view = view;
		this.key_right = false;
		this.key_left = false;
		this.key_up = false;
		this.key_down = false;
		let self = this;
		view.canvas.addEventListener("click", function(event) { self.onClick(event); });
		document.addEventListener('keydown', function(event) { self.keyDown(event); }, false);
		document.addEventListener('keyup', function(event) { self.keyUp(event); }, false);
	}

	onClick(event)
	{
		this.model.onclick(event.pageX - this.view.canvas.offsetLeft, event.pageY - this.view.canvas.offsetTop);
	}


	keyDown(event)
	{
		//general movement
		if(event.keyCode == 39) this.key_right = true;
		else if(event.keyCode == 37) this.key_left = true;
		else if(event.keyCode == 38) this.key_up = true;
		else if(event.keyCode == 40) this.key_down = true;
	}

	keyUp(event)
	{
		//general movement
		if(event.keyCode == 39) this.key_right = false;
		else if(event.keyCode == 37) this.key_left = false;
		else if(event.keyCode == 38) this.key_up = false;
		else if(event.keyCode == 40) this.key_down = false;
	}

	update()
	{
		let dx = 0;
		let dy = 0;
		if(this.key_right) dx++;
		if(this.key_left) dx--;
		if(this.key_up) dy--;
		if(this.key_down) dy++;
		if(dx != 0 || dy != 0)
			this.model.move(dx, dy);
	}
}





class Game
{
	constructor()
	{
		this.model = new Model();
		this.view = new View(this.model);
		this.controller = new Controller(this.model, this.view);
	}

	onTimer()
	{
		this.controller.update();
		this.model.update();
		this.view.update();
	}
}


let game = new Game();
let timer = setInterval(function() { game.onTimer(); }, 16); // 16.666... ms is 60fps

//let music = setInterval(function(){playsound();}, <howlong the sound file is>);

//TODO: add settings to make the game run faster or slower
//setInterval has multiple parameter that are usable to pass in
</script>

</body>
</html>
